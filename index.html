<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LifeTrack Pro - The OS for Your Life</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: { 50: '#eef2ff', 100: '#e0e7ff', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 900: '#312e81' },
                        dark: { 800: '#1e293b', 900: '#0f172a' }
                    },
                    animation: {
                        'slide-in': 'slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1)',
                        'fade-in': 'fadeIn 0.2s ease-out'
                    },
                    keyframes: {
                        slideIn: { '0%': { transform: 'translateY(10px)', opacity: 0 }, '100%': { transform: 'translateY(0)', opacity: 1 } },
                        fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } }
                    }
                }
            }
        }
    </script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* FIX: Removed overflow:hidden from body to allow Landing Page scrolling */
        html, body { height: 100%; margin: 0; padding: 0; }
        #root { height: 100%; }
        
        .scroll-container { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        @media (max-width: 768px) { .scroll-container { padding-bottom: 100px; } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input[type="date"]::-webkit-calendar-picker-indicator { position: absolute; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        * { transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease; }
        .gradient-text { background: linear-gradient(135deg, #2563EB 0%, #1E40AF 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-dark-900 text-gray-800 dark:text-gray-100 font-sans">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, collection, doc, getDoc, setDoc, addDoc, updateDoc, deleteDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // ---------------------------------------------------------
        // âš ï¸ FIREBASE CONFIG
        // ---------------------------------------------------------
        const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
        let auth, db;
        const appId = window.__app_id || 'default-app-id';

        try {
            if (Object.keys(firebaseConfig).length > 0) {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
            }
        } catch (e) {
            console.error("Firebase init error (Guest mode will still work):", e);
        }

        const { useState, useEffect, useRef, createContext, useContext } = React;

        // --- ICONS (SVG Components) ---
        const Icon = ({ children, size = 24, className = "" }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg> );
        
        const Activity = (p) => <Icon {...p}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></Icon>;
        const Home = (p) => <Icon {...p}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
        const CheckSquare = (p) => <Icon {...p}><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></Icon>;
        const Dumbbell = (p) => <Icon {...p}><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></Icon>;
        const Utensils = (p) => <Icon {...p}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></Icon>;
        const Plus = (p) => <Icon {...p}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></Icon>;
        const Trash2 = (p) => <Icon {...p}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></Icon>;
        const Calendar = (p) => <Icon {...p}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></Icon>;
        const CheckCircle = (p) => <Icon {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const Circle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/></Icon>;
        const Flame = (p) => <Icon {...p}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3.3-1.1 1-3.3 3-5.2"/></Icon>;
        const Droplet = (p) => <Icon {...p}><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></Icon>;
        const Zap = (p) => <Icon {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></Icon>;
        const ChevronLeft = (p) => <Icon {...p}><polyline points="15 18 9 12 15 6"/></Icon>;
        const ChevronRight = (p) => <Icon {...p}><polyline points="9 18 15 12 9 6"/></Icon>;
        const Repeat = (p) => <Icon {...p}><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></Icon>;
        const FileText = (p) => <Icon {...p}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></Icon>;
        const X = (p) => <Icon {...p}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></Icon>;
        const ArrowLeft = (p) => <Icon {...p}><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></Icon>;
        const Minus = (p) => <Icon {...p}><line x1="5" y1="12" x2="19" y2="12"/></Icon>;
        const Moon = (p) => <Icon {...p}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></Icon>;
        const Sun = (p) => <Icon {...p}><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></Icon>;
        const Settings = (p) => <Icon {...p}><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></Icon>;
        const LogOut = (p) => <Icon {...p}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></Icon>;
        const PlayCircle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></Icon>;
        const HeartPulse = (p) => <Icon {...p}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/><path d="M12 5 9.04 11 6 8"/></Icon>;
        const Target = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></Icon>;
        const BarChart2 = (p) => <Icon {...p}><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></Icon>;
        const Check = (p) => <Icon {...p}><polyline points="20 6 9 17 4 12"/></Icon>;
        const Shield = (p) => <Icon {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></Icon>;
        const Star = (p) => <Icon {...p}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></Icon>;
        const ListIcon = (p) => <Icon {...p}><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></Icon>;
        const Clock = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></Icon>;
        const GoogleIcon = () => <svg viewBox="0 0 48 48" width="24" height="24"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"/><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"/><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"/></svg>;
        const GuestIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;

        // --- HELPERS ---
        const getTodayString = () => new Date().toISOString().split('T')[0];
        const isVirtualItem = (item) => typeof item.id === 'string' && item.id.startsWith('virtual_');
        const cleanData = (data) => { 
            if (!data) return {};
            const c = { ...data }; 
            delete c.id; 
            delete c.isVirtual; 
            return c; 
        };

        // --- CONTEXT ---
        const ToastContext = createContext();

        function ToastProvider({ children }) {
            const [toast, setToast] = useState(null);
            const timerRef = useRef(null);
            
            const showToast = (message, type = 'success', action = null) => {
                if (timerRef.current) clearTimeout(timerRef.current);
                setToast({ message, type, action });
                timerRef.current = setTimeout(() => {
                    setToast(null);
                    timerRef.current = null;
                }, 6000);
            };

            return (
                <ToastContext.Provider value={{ showToast }}>
                    {children}
                    {toast && (
                        <div className={`fixed bottom-24 md:bottom-10 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-xl shadow-2xl text-white text-sm font-medium z-[100] animate-bounce flex items-center gap-3 ${toast.type === 'error' ? 'bg-red-600' : 'bg-slate-900'}`}>
                            <span>{toast.message}</span>
                            {toast.action && (
                                <button 
                                    onClick={() => { toast.action.onClick(); setToast(null); if (timerRef.current) clearTimeout(timerRef.current); }}
                                    className="bg-white/20 hover:bg-white/30 px-3 py-1 rounded text-xs font-bold uppercase transition"
                                >
                                    {toast.action.label}
                                </button>
                            )}
                        </div>
                    )}
                </ToastContext.Provider>
            );
        }

        // --- CUSTOM HOOK ---
        function useFirestore(userId, collectionName) {
            const [data, setData] = useState([]);

            useEffect(() => {
                if (!userId) return;

                if (userId === 'guest') {
                    const loadLocal = () => {
                        const saved = localStorage.getItem(`lifetrack_${collectionName}`);
                        setData(saved ? JSON.parse(saved) : []);
                    };
                    loadLocal();
                    const handleUpdate = (e) => { if (e.detail.col === collectionName) loadLocal(); };
                    window.addEventListener('lifetrack-update', handleUpdate);
                    return () => window.removeEventListener('lifetrack-update', handleUpdate);
                }

                if (db) {
                    const colRef = collection(db, 'artifacts', appId, 'users', userId, collectionName);
                    const unsubscribe = onSnapshot(colRef, (snapshot) => {
                        const items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setData(items);
                    }, err => console.error("Firestore Error:", err));
                    return unsubscribe;
                }
            }, [userId, collectionName]);

            const add = async (item) => {
                const itemToSave = cleanData({ ...item, createdAt: item.createdAt || new Date().toISOString() });
                if (userId === 'guest') {
                    const newItem = { id: Date.now().toString(), ...itemToSave };
                    const currentLS = localStorage.getItem(`lifetrack_${collectionName}`);
                    const currentData = currentLS ? JSON.parse(currentLS) : [];
                    const newData = [...currentData, newItem];
                    localStorage.setItem(`lifetrack_${collectionName}`, JSON.stringify(newData));
                    setData(newData);
                    window.dispatchEvent(new CustomEvent('lifetrack-update', { detail: { col: collectionName } }));
                    return Promise.resolve({ id: newItem.id });
                }
                if (db) {
                    const colRef = collection(db, 'artifacts', appId, 'users', userId, collectionName);
                    return await addDoc(colRef, itemToSave);
                }
            };

            const update = async (id, updates) => {
                const updatesToSave = cleanData(updates);
                if (userId === 'guest') {
                    const currentLS = localStorage.getItem(`lifetrack_${collectionName}`);
                    const currentData = currentLS ? JSON.parse(currentLS) : [];
                    const newData = currentData.map(i => i.id === id ? { ...i, ...updatesToSave } : i);
                    localStorage.setItem(`lifetrack_${collectionName}`, JSON.stringify(newData));
                    setData(newData);
                    window.dispatchEvent(new CustomEvent('lifetrack-update', { detail: { col: collectionName } }));
                    return Promise.resolve();
                }
                if (db) {
                    const docRef = doc(db, 'artifacts', appId, 'users', userId, collectionName, id);
                    return await updateDoc(docRef, updatesToSave);
                }
            };

            const remove = async (id) => {
                if (userId === 'guest') {
                    const currentLS = localStorage.getItem(`lifetrack_${collectionName}`);
                    const currentData = currentLS ? JSON.parse(currentLS) : [];
                    const newData = currentData.filter(i => i.id !== id);
                    localStorage.setItem(`lifetrack_${collectionName}`, JSON.stringify(newData));
                    setData(newData);
                    window.dispatchEvent(new CustomEvent('lifetrack-update', { detail: { col: collectionName } }));
                    return Promise.resolve();
                }
                if (db) {
                    const docRef = doc(db, 'artifacts', appId, 'users', userId, collectionName, id);
                    return await deleteDoc(docRef);
                }
            };
            return { data, add, update, remove };
        }

        // --- COMPONENTS ---
        const Sidebar = ({ activeTab, setActiveTab, user, onLogout, darkMode, setDarkMode, setShowSettings }) => (
            <aside className="hidden md:flex w-64 flex-col border-r border-gray-200 dark:border-gray-800 bg-white dark:bg-dark-800 p-4 h-full transition-colors">
                <div className="flex items-center gap-2 text-primary-600 dark:text-primary-500 mb-8 px-2">
                    <Activity size={32} />
                    <h1 className="text-2xl font-bold tracking-tight text-gray-900 dark:text-white">LifeTrack</h1>
                </div>
                <nav className="flex-1 space-y-2">
                    <SidebarLink active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} icon={<Home size={20} />} label="Overview" />
                    <SidebarLink active={activeTab === 'todo'} onClick={() => setActiveTab('todo')} icon={<CheckSquare size={20} />} label="Tasks" />
                    <SidebarLink active={activeTab === 'gym'} onClick={() => setActiveTab('gym')} icon={<Dumbbell size={20} />} label="Workout" />
                    <SidebarLink active={activeTab === 'diet'} onClick={() => setActiveTab('diet')} icon={<Utensils size={20} />} label="Nutrition" />
                </nav>
                <div className="mt-auto space-y-2 pt-4 border-t border-gray-100 dark:border-gray-700">
                    <button onClick={() => setDarkMode(!darkMode)} className="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-800 transition">
                        {darkMode ? <Sun size={20} /> : <Moon size={20} />}
                        {darkMode ? "Light Mode" : "Dark Mode"}
                    </button>
                    <button onClick={() => setShowSettings(true)} className="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-800 transition">
                        <Settings size={20} /> Settings
                    </button>
                    <div className="h-px bg-gray-200 dark:bg-gray-700 my-2 mx-2"></div>
                    <div className="flex items-center gap-3 p-2 rounded-xl bg-gray-50 dark:bg-gray-800/50 mt-2 border border-transparent hover:border-gray-200 dark:hover:border-gray-700 transition-all">
                        <div className="w-10 h-10 rounded-full bg-gradient-to-tr from-primary-500 to-indigo-600 flex items-center justify-center text-white font-bold shadow-sm">
                            {user.displayName ? user.displayName.charAt(0) : 'G'}
                        </div>
                        <div className="flex-1 overflow-hidden">
                            <p className="text-sm font-bold text-gray-900 dark:text-white truncate">{user.displayName || 'Guest User'}</p>
                            <p className="text-xs text-gray-500 truncate">Pro Plan</p>
                        </div>
                        <button onClick={onLogout} className="text-gray-400 hover:text-red-500 transition p-1 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg"><LogOut size={18} /></button>
                    </div>
                </div>
            </aside>
        );

        const SidebarLink = ({ active, onClick, icon, label }) => (
            <button onClick={onClick} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all ${active ? 'bg-primary-50 text-primary-700 dark:bg-primary-900/20 dark:text-primary-400' : 'text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-800'}`}>
                {icon} {label}
            </button>
        );

        const DateNavigator = ({ selectedDate, setSelectedDate }) => {
            const changeDate = (days) => {
                const date = new Date(selectedDate);
                date.setDate(date.getDate() + days);
                setSelectedDate(date.toISOString().split('T')[0]);
            };
            const isToday = selectedDate === getTodayString();
            const displayDate = new Date(selectedDate).toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
            return (
                <div className="flex items-center justify-between bg-white dark:bg-dark-800 p-3 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 mb-6">
                    <button onClick={() => changeDate(-1)} className="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-600 dark:text-gray-300"><ChevronLeft size={20} /></button>
                    <div className="flex flex-col items-center"><span className="text-sm font-bold text-gray-800 dark:text-white">{isToday ? "Today's Overview" : displayDate}</span></div>
                    <button onClick={() => changeDate(1)} className="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-600 dark:text-gray-300"><ChevronRight size={20} /></button>
                </div>
            );
        };

        const WaterProgressCircle = ({ value, max, color, size = 100 }) => {
            const radius = (size - 10) / 2;
            const circumference = 2 * Math.PI * radius;
            const percentage = Math.min(value / max, 1);
            const offset = circumference - percentage * circumference;
            return (
                <div className="relative flex items-center justify-center" style={{ width: size, height: size }}>
                    <svg width={size} height={size} className="transform -rotate-90">
                        <circle cx={size/2} cy={size/2} r={radius} stroke="#f3f4f6" strokeWidth="8" fill="transparent" className="dark:stroke-gray-700" />
                        <circle cx={size/2} cy={size/2} r={radius} stroke={color} strokeWidth="8" fill="transparent" strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" className="transition-all duration-1000 ease-out" />
                    </svg>
                    <div className="absolute flex flex-col items-center"><span className="text-xl font-bold text-gray-700 dark:text-white">{value}L</span><span className="text-[10px] text-gray-400">/ {max}L</span></div>
                </div>
            );
        };

        function DashboardSection({ userId, selectedDate, goals }) {
            const { data: diet } = useFirestore(userId, 'diet');
            const { data: todos } = useFirestore(userId, 'todos');
            const { data: water } = useFirestore(userId, 'water');
            const todaysMeals = diet.filter(m => m.date === selectedDate && m.completed);
            const calCurrent = todaysMeals.reduce((acc, curr) => acc + Number(curr.calories), 0);
            const waterLog = water.find(w => w.date === selectedDate);
            const waterCurrent = waterLog ? waterLog.amount : 0;
            const todaysTasks = todos.filter(t => t.date === selectedDate);
            const tasksDone = todaysTasks.filter(t => t.completed).length;
            const tasksTotal = todaysTasks.length;
            const calPct = goals.calories ? Math.round((calCurrent/goals.calories)*100) : 0;
            const taskPct = tasksTotal ? Math.round((tasksDone/tasksTotal)*100) : 0;

            return (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 animate-fade-in">
                    <div className="col-span-1 md:col-span-2 lg:col-span-4 bg-gradient-to-r from-primary-600 to-indigo-700 rounded-2xl p-8 text-white shadow-xl">
                        <h2 className="text-3xl font-bold mb-2">Hello, {userId === 'guest' ? 'Guest' : 'Chief'}! ðŸ‘‹</h2>
                        <p className="text-indigo-100 mb-6">Here is your summary for today.</p>
                        <div className="flex gap-16">
                            <div><div className="text-4xl font-bold">{calPct}%</div><div className="text-xs uppercase opacity-70 tracking-wider">Diet Goal</div></div>
                            <div className="border-l border-indigo-500/30 pl-16"><div className="text-4xl font-bold">{taskPct}%</div><div className="text-xs uppercase opacity-70 tracking-wider">Tasks Done</div></div>
                        </div>
                    </div>
                    <div className="bg-white dark:bg-dark-800 p-6 rounded-2xl border border-gray-100 dark:border-gray-700 shadow-sm"><div className="flex items-center gap-2 text-blue-500 mb-4 font-bold text-sm"><CheckSquare size={20} /> Tasks</div><div className="text-3xl font-bold text-gray-900 dark:text-white">{tasksDone} <span className="text-gray-400 text-lg">/ {tasksTotal}</span></div><div className="w-full bg-gray-100 dark:bg-gray-700 h-2 rounded-full mt-4"><div className="bg-blue-500 h-full rounded-full transition-all duration-1000" style={{ width: `${tasksTotal ? (tasksDone/tasksTotal)*100 : 0}%` }}></div></div></div>
                    <div className="bg-white dark:bg-dark-800 p-6 rounded-2xl border border-gray-100 dark:border-gray-700 shadow-sm flex flex-col justify-between"><div><div className="flex justify-between mb-2"><div className="flex items-center gap-1 text-orange-500 font-bold text-sm"><Flame size={16} /> Calories</div><span className="text-xs text-gray-500">{calCurrent}/{goals.calories}</span></div><div className="w-full bg-gray-100 dark:bg-gray-700 h-2 rounded-full mb-4"><div className="bg-orange-500 h-full rounded-full transition-all duration-1000" style={{ width: `${Math.min((calCurrent/goals.calories)*100, 100)}%` }}></div></div></div></div>
                    <div className="bg-white dark:bg-dark-800 p-6 rounded-2xl border border-gray-100 dark:border-gray-700 shadow-sm flex items-center justify-between"><div><div className="flex items-center gap-2 text-cyan-500 font-bold text-sm mb-2"><Droplet size={20} /> Water</div><div className="text-3xl font-bold text-gray-900 dark:text-white">{waterCurrent}L</div></div><WaterProgressCircle value={waterCurrent} max={goals.water} color="#06b6d4" size={80} /></div>
                </div>
            );
        }

        function TodoSection({ userId, selectedDate }) {
            const { showToast } = useContext(ToastContext);
            const { data: tasks, add: addTaskToDb, update: updateTaskInDb, remove: removeTaskFromDb } = useFirestore(userId, 'todos');
            const [newTask, setNewTask] = useState('');
            const todaysTasks = tasks.filter(t => t.date === selectedDate);
            const handleAddTask = (e) => { e.preventDefault(); if(!newTask.trim()) return; addTaskToDb({ text: newTask, completed: false, date: selectedDate }); setNewTask(''); showToast('Task Added'); };
            return (
                <div className="space-y-6 animate-fade-in">
                    <form onSubmit={handleAddTask} className="flex gap-3"><input type="text" value={newTask} onChange={(e) => setNewTask(e.target.value)} placeholder="Add a new task..." className="flex-1 p-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-800 dark:text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500" /><button className="bg-primary-600 text-white px-6 rounded-xl font-bold shadow-md hover:bg-primary-700 transition"><Plus size={20} /></button></form>
                    <div className="space-y-3 pb-24 md:pb-0">{todaysTasks.map(task => (<div key={task.id} className={`flex items-center justify-between p-4 bg-white dark:bg-dark-800 rounded-xl shadow-sm border-l-4 transition-all ${task.completed ? 'border-green-500 opacity-60' : 'border-primary-500'}`}><div className="flex items-center gap-3 overflow-hidden"><button onClick={() => updateTaskInDb(task.id, { completed: !task.completed })} className={task.completed ? 'text-green-500' : 'text-gray-300'}>{task.completed ? <CheckCircle size={24} /> : <Circle size={24} />}</button><span className={`font-medium truncate ${task.completed ? 'line-through text-gray-400' : 'text-gray-800 dark:text-white'}`}>{task.text}</span></div><button onClick={() => removeTaskFromDb(task.id)} className="text-gray-300 hover:text-red-500"><Trash2 size={18} /></button></div>))}</div>
                </div>
            );
        }

        function GymSection({ userId, selectedDate }) {
            const { data: workouts, add: addWorkout, remove: deleteWorkout } = useFirestore(userId, 'gym');
            const [entry, setEntry] = useState({ exercise: '', sets: '', reps: '', weight: '' });
            const { showToast } = useContext(ToastContext);
            const addSet = (e) => { e.preventDefault(); if (!entry.exercise) return; addWorkout({ ...entry, date: selectedDate }); setEntry({ ...entry, sets: '', reps: '', weight: '' }); showToast('Set Logged'); };
            const todaysWorkouts = workouts.filter(w => w.date === selectedDate);
            return (
                <div className="space-y-6 animate-fade-in"><div className="bg-white dark:bg-dark-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700"><h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-gray-900 dark:text-white"><Dumbbell className="text-primary-600" size={24} /> Log Workout</h2><form onSubmit={addSet} className="space-y-4"><input type="text" placeholder="Exercise Name" className="w-full p-3 rounded-xl border dark:border-gray-600 bg-gray-50 dark:bg-dark-900 dark:text-white" value={entry.exercise} onChange={e => setEntry({...entry, exercise: e.target.value})} /><div className="grid grid-cols-3 gap-3"><input type="number" placeholder="kg" className="w-full p-3 rounded-xl border dark:border-gray-600 bg-gray-50 dark:bg-dark-900 text-center dark:text-white" value={entry.weight} onChange={e => setEntry({...entry, weight: e.target.value})} /><input type="number" placeholder="Sets" className="w-full p-3 rounded-xl border dark:border-gray-600 bg-gray-50 dark:bg-dark-900 text-center dark:text-white" value={entry.sets} onChange={e => setEntry({...entry, sets: e.target.value})} /><input type="number" placeholder="Reps" className="w-full p-3 rounded-xl border dark:border-gray-600 bg-gray-50 dark:bg-dark-900 text-center dark:text-white" value={entry.reps} onChange={e => setEntry({...entry, reps: e.target.value})} /></div><button className="w-full bg-gray-900 dark:bg-white text-white dark:text-gray-900 py-3 rounded-xl font-bold shadow-md hover:opacity-90">Log Set</button></form></div><div className="space-y-3 pb-20 md:pb-0">{todaysWorkouts.map((w) => (<div key={w.id} className="bg-white dark:bg-dark-800 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 flex justify-between items-center hover-card"><div><p className="font-bold text-gray-800 dark:text-white">{w.exercise}</p><p className="text-sm text-gray-500 dark:text-gray-400">{w.weight}kg Ã— {w.sets} sets Ã— {w.reps} reps</p></div><button onClick={() => deleteWorkout(w.id)} className="text-gray-300 hover:text-red-500"><Trash2 size={18} /></button></div>))}</div></div>
            );
        }

        function DietSection({ userId, selectedDate }) {
            const { data: meals, add: addMealDb, update: updateMealDb, remove: removeMealDb } = useFirestore(userId, 'diet');
            const [newMeal, setNewMeal] = useState({ name: '', calories: '', protein: '' });
            const { showToast } = useContext(ToastContext);
            const manualMeals = meals.filter(m => m.date === selectedDate);
            const handleAddMeal = (e) => { e.preventDefault(); if (!newMeal.name) return; addMealDb({ ...newMeal, date: selectedDate, completed: false }); setNewMeal({ name: '', calories: '', protein: '' }); showToast('Meal Added'); };
            return (
                <div className="space-y-6 animate-fade-in pb-20 md:pb-0"><div className="bg-white dark:bg-dark-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700"><h3 className="font-bold text-gray-900 dark:text-white mb-4">Log Meal</h3><form onSubmit={handleAddMeal} className="flex flex-col gap-3"><input type="text" placeholder="Add Meal (e.g. Oats)" className="w-full p-3 rounded-xl border dark:border-gray-600 bg-gray-50 dark:bg-dark-900 dark:text-white" value={newMeal.name} onChange={e => setNewMeal({...newMeal, name: e.target.value})} /><div className="flex gap-2"><input type="number" placeholder="Cals" className="w-full p-3 rounded-xl border dark:border-gray-600 bg-gray-50 dark:bg-dark-900 dark:text-white text-center" value={newMeal.calories} onChange={e => setNewMeal({...newMeal, calories: e.target.value})} /><input type="number" placeholder="Prot" className="w-full p-3 rounded-xl border dark:border-gray-600 bg-gray-50 dark:bg-dark-900 dark:text-white text-center" value={newMeal.protein} onChange={e => setNewMeal({...newMeal, protein: e.target.value})} /><button className="bg-green-600 text-white px-4 rounded-xl font-bold"><Plus /></button></div></form></div><div className="space-y-3">{manualMeals.map(meal => (<div key={meal.id} className={`flex items-center justify-between p-3 bg-white dark:bg-dark-800 rounded-xl border border-gray-100 dark:border-gray-700 hover:shadow-sm transition hover:bg-gray-50 dark:hover:bg-gray-800/50 ${meal.completed ? 'opacity-50' : ''}`}><div className="flex items-center gap-3 overflow-hidden flex-1"><button onClick={() => updateMealDb(meal.id, { completed: !meal.completed })} className={`text-xl ${meal.completed ? 'text-green-500' : 'text-gray-300 dark:text-gray-600'}`}>{meal.completed ? <CheckCircle size={24} /> : <Circle size={24} />}</button><div><p className={`font-medium text-gray-800 dark:text-white ${meal.completed ? 'line-through' : ''}`}>{meal.name}</p><p className="text-xs text-gray-500 dark:text-gray-400">{meal.calories} cal â€¢ {meal.protein}g prot</p></div></div><button onClick={() => removeMealDb(meal.id)} className="text-gray-300 hover:text-red-500"><Trash2 size={18} /></button></div>))}</div></div>
            );
        }

        // App Component
        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [globalDate, setGlobalDate] = useState(getTodayString());
            const [darkMode, setDarkMode] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [authModal, setAuthModal] = useState(null);
            const [goals, setGoals] = useState({ calories: 2500, protein: 160, water: 4 });

            useEffect(() => { if(darkMode) document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); }, [darkMode]);
            useEffect(() => {
                if (auth) { onAuthStateChanged(auth, (u) => setUser(u)); } 
                else { const guest = localStorage.getItem('lifetrack_guest'); if (guest) setUser({ uid: 'guest', displayName: 'Guest User' }); }
            }, []);

            const loginAsGuest = () => { const guestUser = { uid: 'guest', displayName: 'Guest User' }; setUser(guestUser); localStorage.setItem('lifetrack_guest', 'true'); setAuthModal(null); };
            const handleLogout = () => { if (auth) signOut(auth); setUser(null); localStorage.removeItem('lifetrack_guest'); setActiveTab('dashboard'); };

            if (!user) {
                return (
                    <div className="bg-gray-50 text-gray-900 font-sans min-h-screen">
                        {/* Landing Page (Logged Out) */}
                        <nav className="fixed w-full bg-white/80 backdrop-blur-md border-b border-gray-200 z-50">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div className="flex justify-between items-center h-16"><div className="flex items-center gap-2"><Activity className="text-primary-600 w-8 h-8" /><span className="font-bold text-xl tracking-tight">LifeTrack Pro</span></div><div className="flex items-center gap-4"><button onClick={() => setAuthModal('login')} className="text-gray-600 hover:text-primary-600 font-medium">Login</button><button onClick={() => setAuthModal('register')} className="bg-primary-600 hover:bg-primary-700 text-white px-5 py-2 rounded-full font-medium shadow-lg shadow-primary-600/20">Get Started</button></div></div></div>
                        </nav>
                        <section className="pt-32 pb-20 lg:pt-40 lg:pb-28 overflow-hidden"><div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center"><div className="inline-flex items-center px-3 py-1 rounded-full bg-primary-50 text-primary-600 text-sm font-medium mb-6"><span className="mr-2">âœ¨</span> New: AI-Powered Insights 2.0</div><h1 className="text-5xl lg:text-7xl font-bold tracking-tight mb-8 text-gray-900">Track Your Life <br /><span className="gradient-text">Better Than Ever</span></h1><p className="text-xl text-gray-600 mb-10 max-w-2xl mx-auto leading-relaxed">The all-in-one platform for tracking habits, health, and goals.</p><div className="flex flex-col sm:flex-row justify-center gap-4"><button onClick={() => setAuthModal('register')} className="px-8 py-4 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-xl font-semibold text-lg hover:shadow-xl hover:shadow-primary-600/20">Start Tracking Free</button><button className="px-8 py-4 bg-white text-gray-700 border border-gray-200 rounded-xl font-semibold text-lg hover:bg-gray-50 flex items-center justify-center gap-2"><PlayCircle className="w-5 h-5" /> Watch Demo</button></div></div></section>
                        <section id="features" className="py-20 bg-white"><div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div className="text-center mb-16"><h2 className="text-3xl font-bold text-gray-900 mb-4">Everything you need to succeed</h2><p className="text-lg text-gray-600">Powerful tools designed to help you build better habits.</p></div><div className="grid md:grid-cols-3 gap-8">{[{ icon: HeartPulse, title: 'Health Tracking', desc: 'Monitor vitals & sleep.' }, { icon: Target, title: 'Daily Goals', desc: 'Crush your objectives.' }, { icon: BarChart2, title: 'Analytics', desc: 'Visualize your growth.' }].map((f, i) => (<div key={i} className="p-8 rounded-2xl bg-gray-50 border border-gray-100 hover:border-primary-200 hover:shadow-lg transition group"><div className="w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center mb-6 group-hover:bg-primary-600 transition"><f.icon className="w-6 h-6 text-primary-600 group-hover:text-white transition" /></div><h3 className="text-xl font-bold mb-3">{f.title}</h3><p className="text-gray-600">{f.desc}</p></div>))}</div></div></section>
                        <section id="pricing" className="py-20 bg-gray-50"><div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div className="text-center mb-16"><h2 className="text-3xl font-bold text-gray-900 mb-4">Simple, transparent pricing</h2><p className="text-lg text-gray-600">Choose the plan that fits your lifestyle.</p></div><div className="grid md:grid-cols-3 gap-8 max-w-5xl mx-auto"><div className="bg-white p-8 rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition"><h3 className="text-xl font-bold text-gray-900">Starter</h3><div className="my-4"><span className="text-4xl font-bold">Free</span></div><p class="text-gray-500 mb-6 text-sm">Forever free for individuals.</p><ul class="space-y-3 mb-8"><li class="flex items-center text-gray-600 text-sm"><Check class="w-4 h-4 text-green-500 mr-2" /> Basic Tracking</li><li class="flex items-center text-gray-600 text-sm"><Check class="w-4 h-4 text-green-500 mr-2" /> 3 Goals per day</li><li class="flex items-center text-gray-600 text-sm"><Check class="w-4 h-4 text-green-500 mr-2" /> 7-day history</li></ul><button onClick={() => setAuthModal('register')} class="w-full py-3 px-4 border border-gray-200 rounded-xl font-medium text-gray-600 hover:bg-gray-50 transition">Get Started</button></div><div class="bg-white p-8 rounded-2xl border-2 border-primary-600 shadow-xl relative transform scale-105 z-10"><div class="absolute top-0 right-0 bg-primary-600 text-white text-xs font-bold px-3 py-1 rounded-bl-xl rounded-tr-xl">POPULAR</div><h3 class="text-xl font-bold text-gray-900">Pro</h3><div class="my-4"><span class="text-4xl font-bold">â‚¹99</span><span class="text-gray-500">/mo</span></div><p class="text-gray-500 mb-6 text-sm">For serious self-improvers.</p><ul class="space-y-3 mb-8"><li class="flex items-center text-gray-600 text-sm"><Check class="w-4 h-4 text-green-500 mr-2" /> Unlimited Tracking</li><li class="flex items-center text-gray-600 text-sm"><Check class="w-4 h-4 text-green-500 mr-2" /> Advanced Charts</li><li class="flex items-center text-gray-600 text-sm"><Check class="w-4 h-4 text-green-500 mr-2" /> Priority Support</li></ul><button onClick={() => setAuthModal('register')} class="w-full py-3 px-4 bg-primary-600 text-white rounded-xl font-medium hover:bg-primary-700 transition shadow-lg shadow-primary-600/25">Upgrade to Pro</button></div><div class="bg-white p-8 rounded-2xl border border-gray-200 shadow-sm hover:shadow-md transition"><h3 class="text-xl font-bold text-gray-900">Premium</h3><div class="my-4"><span class="text-4xl font-bold">â‚¹299</span><span class="text-gray-500">/mo</span></div><p class="text-gray-500 mb-6 text-sm">Complete access for power users.</p><ul class="space-y-3 mb-8"><li class="flex items-center text-gray-600 text-sm"><Check class="w-4 h-4 text-green-500 mr-2" /> AI Coaching</li><li class="flex items-center text-gray-600 text-sm"><Check class="w-4 h-4 text-green-500 mr-2" /> Data Export</li><li class="flex items-center text-gray-600 text-sm"><Check class="w-4 h-4 text-green-500 mr-2" /> Team Features</li></ul><button class="w-full py-3 px-4 border border-gray-200 rounded-xl font-medium text-gray-600 hover:bg-gray-50 transition">Contact Sales</button></div></div></div></section>
                        <section class="py-24 bg-gradient-to-br from-gray-900 via-primary-950 to-gray-900 text-white"><div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center"><h2 class="text-3xl md:text-5xl font-bold mb-8 leading-tight">Get weekly productivity tips. No spam.</h2><div class="max-w-xl mx-auto bg-gray-800/50 p-1.5 rounded-full border border-gray-700 flex items-center mb-6"><input type="email" placeholder="Enter your email" class="w-full bg-transparent px-6 py-3 text-white placeholder-gray-400 focus:outline-none rounded-l-full" /><button class="bg-white text-gray-900 font-bold text-base px-8 py-3 rounded-full hover:bg-gray-100 transition">Subscribe</button></div><div class="flex items-center justify-center gap-2 text-gray-500 text-xs"><Shield class="w-3 h-3" /><span>Secure. Private.</span></div></div></section>
                        <footer class="bg-white pt-20 pb-10 border-t border-gray-200"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-16"><div class="md:col-span-1"><div class="flex items-center gap-2 mb-6"><Activity class="text-primary-600 w-8 h-8" /><span class="font-bold text-2xl text-gray-900">LifeTrack Pro</span></div><p class="text-sm text-gray-500 mb-6 leading-relaxed">Making self-improvement accessible.</p><div class="flex gap-1 text-gray-400"><Star class="w-4 h-4 fill-current" /><Star class="w-4 h-4 fill-current" /><Star class="w-4 h-4 fill-current" /></div></div><div class="grid grid-cols-3 gap-8 md:col-span-3"><div><h4 class="font-bold text-base text-gray-900 mb-4">Product</h4><ul class="space-y-3"><li><a href="#" class="text-sm text-gray-500 hover:text-primary-600 transition">Features</a></li><li><a href="#" class="text-sm text-gray-500 hover:text-primary-600 transition">Pricing</a></li></ul></div><div><h4 class="font-bold text-base text-gray-900 mb-4">Company</h4><ul class="space-y-3"><li><a href="#" class="text-sm text-gray-500 hover:text-primary-600 transition">About</a></li><li><a href="#" class="text-sm text-gray-500 hover:text-primary-600 transition">Contact</a></li></ul></div><div><h4 class="font-bold text-base text-gray-900 mb-4">Legal</h4><ul class="space-y-3"><li><a href="#" class="text-sm text-gray-500 hover:text-primary-600 transition">Privacy</a></li><li><a href="#" class="text-sm text-gray-500 hover:text-primary-600 transition">Terms</a></li></ul></div></div></div><div class="pt-8 border-t border-gray-100 flex flex-col md:flex-row justify-between items-center text-xs text-gray-400"><p>Â© 2026 LifeTrack Pro.</p><p class="mt-4 md:mt-0">Made with passion.</p></div></div></footer>
                        
                        {authModal && (<div className="fixed inset-0 z-[60] bg-white flex flex-col items-center justify-center p-4 animate-fade-in"><div className="w-full max-w-sm text-center"><div className="flex justify-center mb-4 text-primary-600"><Activity size={48} /></div><h1 className="text-2xl font-bold text-gray-800 mb-2">LifeTrack Pro</h1><p className="text-gray-500 mb-8 text-sm">Your personal hub.</p><button onClick={() => { if(auth) signInAnonymously(auth); else loginAsGuest(); }} className="w-full bg-white border border-gray-300 p-3 rounded-xl hover:bg-gray-50 font-medium text-gray-700 mb-3">Sign in / Demo</button><div className="relative flex py-2 items-center"><div className="flex-grow border-t border-gray-300"></div><span className="flex-shrink mx-4 text-gray-400 text-xs">OR</span><div className="flex-grow border-t border-gray-300"></div></div><button onClick={loginAsGuest} className="w-full bg-gray-800 text-white p-3 rounded-xl hover:bg-gray-900 font-medium mt-3">Guest Mode</button><button onClick={() => setAuthModal(null)} className="mt-6 text-gray-400 text-sm hover:text-gray-600">Back</button></div></div>)}
                    </div>
                );
            }

            return (
                <ToastProvider>
                    <div className="h-full flex flex-col md:flex-row bg-gray-50 dark:bg-dark-900 transition-colors duration-300 min-h-screen">
                        <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} user={user} onLogout={handleLogout} darkMode={darkMode} setDarkMode={setDarkMode} setShowSettings={setShowSettings} />
                        <div className="flex-1 flex flex-col h-full overflow-hidden relative">
                            <header className="md:hidden bg-white dark:bg-dark-800 border-b border-gray-200 dark:border-gray-700 p-4 sticky top-0 z-30 flex justify-between items-center"><div className="flex items-center gap-2 text-primary-600 dark:text-primary-500"><Activity size={28} /><h1 className="text-xl font-bold text-gray-900 dark:text-white">LifeTrack</h1></div><div className="flex items-center gap-4"><button onClick={() => setDarkMode(!darkMode)} className="text-gray-500 dark:text-gray-400">{darkMode ? <Sun size={20} /> : <Moon size={20} />}</button><button onClick={() => setShowSettings(true)} className="text-gray-500 dark:text-gray-400"><Settings size={20} /></button></div></header>
                            <div className="hidden md:flex justify-between items-center p-6 pb-0 max-w-5xl mx-auto w-full"><h2 className="text-2xl font-bold text-gray-900 dark:text-white">{activeTab === 'dashboard' ? 'Overview' : activeTab === 'todo' ? 'Tasks' : activeTab === 'gym' ? 'Workout Log' : 'Diet Tracker'}</h2></div>
                            <div className="flex-1 overflow-y-auto p-4 md:p-6"><main className="max-w-5xl mx-auto pb-24 md:pb-0"><DateNavigator selectedDate={globalDate} setSelectedDate={setGlobalDate} />{activeTab === 'dashboard' && <DashboardSection userId={user.uid} selectedDate={globalDate} goals={goals} />}{activeTab === 'todo' && <TodoSection userId={user.uid} selectedDate={globalDate} />}{/* Gym/Diet logic reused */}{activeTab === 'gym' && <GymSection userId={user.uid} selectedDate={globalDate} />}{activeTab === 'diet' && <DietSection userId={user.uid} selectedDate={globalDate} goals={goals} />}</main></div>
                            <nav className="md:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-dark-800 border-t border-gray-200 dark:border-gray-700 px-6 py-3 flex justify-between items-center z-40">{[{id: 'dashboard', icon: Home, l: 'Home'}, {id: 'todo', icon: CheckSquare, l: 'Tasks'}, {id: 'gym', icon: Dumbbell, l: 'Gym'}, {id: 'diet', icon: Utensils, l: 'Diet'}].map(t => (<button key={t.id} onClick={() => setActiveTab(t.id)} className={`flex flex-col items-center gap-1 ${activeTab === t.id ? 'text-primary-600' : 'text-gray-400'}`}><t.icon size={24} /><span className="text-[10px] font-medium">{t.l}</span></button>))}</nav>
                        </div>
                    </div>
                </ToastProvider>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>